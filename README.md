# SourceTransform

Utilities to deal with java source code.

What it can do:

  * Read inheritance and member information from class files and create an inheritance map.
  * Read a json transformer and some mappings to produce additional mappings for the source code.
  * Rename local variables according to the json transformer.
  * Custom inspections (These are not really functional yet)
  * Sanitizing [Parchment](https://github.com/ParchmentMC/Parchment) exports for the use with given source code, so the source code will stay compilable after the Parchment data has been applied.

SourceTransform is meant to be used together with [Srg2Source](https://github.com/MinecraftForge/Srg2Source).

## Create an inheritance map

An inheritance map is created from bytecode. For some source code, it contains inheritance information for each class used, all fields, methods and parameters that exist in the source and information about which methods override other methods. This also scans synthetic methods that are generated by the compiler for overrides hwn using generics.

To create an inheritance map, use `sourcetransform inheritance`. It accepts the following options:

  * `-c`, `--classes`: Folder with compiled classes from your source code.
  * `-l`, `--locals`: When this is set, inheritance information will be added for all locals, not just types used in fields and method return or parameter types.
  * `-o`, `--output`: Output file to write the inheritance map to.
  * `-p`, `--classpath`: The classpath used to compile the classes. **This must also include the jars / jmods for the java platform libraries**

## Remap an inheritance map

With `sourcetransform remap`, you can remap an inheritance map with a given mapping file. It accepts the following options:

  * `-i`, `--input`: The input inheritance map
  * `-m`, `--mappings`: The mappings to apply
  * `-o`, `--output`: The output inheritance map

## Apply a transformer

SourceTransform can apply a transformer to a set of mappings using an inheritance map. This will create additional mappings. A transformer specifies rules on how to rename things. This was created to easily change names from MCP to official when updating forge mods to 1.17.

A transformer is a json object with two elements:

  * `api`: This should be `1`
  * `transformers` is a list of transformers to apply. Each name is checked against all of them and the first matching will be applied.

A transformer is a json object that looks like this:

*Documentation will follow*

## Create renames for local variables

*Documentation will follow*

## Apply renames for local variables

*Documentation will follow*

## Stage renames for local variables as comments

This exists so you can run Srg2Source before applying the local renames as it would otherwise.

*Documentation will follow*

## Sanitize a parchment export to be usable with some source code

`sourcetransform sanitize` will change parameter names from a parchment export, so they can be applied to source code while leaving it compilable.

For this it needs a parchment export json, an inheritance map and the compile classpath.

  * `-i`, `--inheritance`: An inheritance map created from the source code that the parchment mappings should be applied to.
  * `-l`, `--level`: Java source level of the source code. One of `java_8`, `java_10` or `java_16`. Defaults to `java_16`.
  * `-m`, `--input`: The parchment export json to read.
  * `-o`, `--output`: Where to write the new sanitized export json.
  * `-p`, `--classpath`: classpath required to compile the source code. **This must also include the jars / jmods for the java platform libraries**
  * `-s`, `--sources`: The folder that contains the java source files to process.